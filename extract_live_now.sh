#!/bin/bash

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ุงุณุชุฎุฑุงุฌ ุงูุจุซ ุงููุจุงุดุฑ ููุท (ูุฌุจ ุฃู ูููู ุดุบุงู ุงูุขู)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

clear
echo -e "${RED}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${RED}โ๏ธ  ุชุญุฐูุฑ: ูุฌุจ ุฃู ูููู ุงูุจุซ ูุจุงุดุฑ ุงูุขู! ๐ด${NC}"
echo -e "${RED}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

FB_URL="https://www.facebook.com/share/v/1Z2tW5hrLs/"
COOKIE_FILE="facebook_cookies.txt"

echo -e "${YELLOW}ุงูุจุซ:${NC} $FB_URL"
echo -e "${YELLOW}ุงูููููุฒ:${NC} $COOKIE_FILE"
echo ""
echo -e "${CYAN}ุฌุงุฑู ุงูุงุณุชุฎุฑุงุฌ...${NC}"
echo ""

# ุงุณุชุฎุฑุงุฌ ูู ุงูุตูุบ ุงููุชุงุญุฉ
echo -e "${BLUE}โโโ ุงูุตูุบ ุงููุชุงุญุฉ โโโ${NC}"
yt-dlp --cookies "$COOKIE_FILE" -F "$FB_URL" 2>&1 | grep -E "(format|ID|DASH|m3u8|mp4)" || echo "ูุง ุชูุฌุฏ ูุนูููุงุช"

echo ""
echo -e "${BLUE}โโโ ูุญุงููุฉ ุงูุญุตูู ุนูู ุฃูุถู ุฑุงุจุท โโโ${NC}"

# ูุญุงููุฉ ุงูุญุตูู ุนูู M3U8 (ุงูุจุซ ุงููุจุงุดุฑ)
STREAM_URL=$(yt-dlp --cookies "$COOKIE_FILE" -f "best" --get-url "$FB_URL" 2>&1 | head -1)

echo ""
if [[ "$STREAM_URL" == *"m3u8"* ]]; then
    echo -e "${GREEN}โ ุชู ุงูุนุซูุฑ ุนูู ุจุซ ูุจุงุดุฑ M3U8!${NC}"
    echo ""
    echo -e "${CYAN}ุงูุฑุงุจุท:${NC}"
    echo "$STREAM_URL"
    
    # ุญูุธ ูู ููู
    echo "$STREAM_URL" > live_stream_url.txt
    echo ""
    echo -e "${GREEN}ุชู ุงูุญูุธ ูู:${NC} live_stream_url.txt"
    
    # ุชุญุฏูุซ config.sh
    echo ""
    read -p "ูู ุชุฑูุฏ ุชุญุฏูุซ config.shุ (y/n): " UPDATE
    if [[ "$UPDATE" =~ ^[Yy]$ ]]; then
        cp config.sh config.sh.backup
        sed -i "s|^SOURCE=.*|SOURCE=\"$STREAM_URL\"|" config.sh
        echo -e "${GREEN}โ ุชู ุงูุชุญุฏูุซ!${NC}"
    fi
    
elif [[ "$STREAM_URL" == *"mp4"* ]]; then
    echo -e "${YELLOW}โ๏ธ  ุชู ุงูุนุซูุฑ ุนูู ููุฏูู MP4 (ููุณ ุจุซ ูุจุงุดุฑ)${NC}"
    echo ""
    echo -e "${CYAN}ุงูุฑุงุจุท:${NC}"
    echo "$STREAM_URL"
    echo ""
    echo -e "${RED}ุงูุณุจุจ ุงููุญุชูู:${NC}"
    echo "  - ุงูุจุซ ุงูุชูู ูุฃุตุจุญ ููุฏูู ูุณุฌู"
    echo "  - ุงูุจุซ ููุณ ูุจุงุดุฑ ุงูุขู"
    echo ""
    echo -e "${BLUE}ุงูุญู:${NC}"
    echo "  - ุงูุชุธุฑ ุญุชู ูุจุฏุฃ ุงูุจุซ ุงููุจุงุดุฑ ๐ด"
    echo "  - ุดุบู ูุฐุง ุงูุณูุฑูุจุช ูุฑุฉ ุฃุฎุฑู ุฃุซูุงุก ุงูุจุซ"
else
    echo -e "${RED}โ ูุดู ุงูุงุณุชุฎุฑุงุฌ${NC}"
    echo "$STREAM_URL"
fi

echo ""
